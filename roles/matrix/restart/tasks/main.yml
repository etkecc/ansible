---
# NOTE: "ignore_errors: true" used as workaround for bad behavior on low RAM servers

- name: Ensure init system reloaded before any restarts restarted
  ansible.builtin.service:
    daemon_reload: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-discord
    - setup-appservice-irc
    - setup-appservice-kakaotalk
    - setup-appservice-slack
    - setup-appservice-webhooks
    - setup-backup-borg
    - setup-beeper-linkedin
    - setup-bot-buscarron
    - setup-bot-go-neb
    - setup-bot-honoroit
    - setup-bot-matrix-reminder-bot
    - setup-bot-maubot
    - setup-bot-mjolnir
    - setup-bot-postmoogle
    - setup-cactus-comments
    - setup-client-cinny
    - setup-client-element
    - setup-client-hydrogen
    - setup-conduit
    - setup-corporal
    - setup-coturn
    - setup-dendrite
    - setup-dimension
    - setup-dnsmasq
    - setup-dynamic-dns
    - setup-email2matrix
    - setup-etherpad
    - setup-go-skype-bridge
    - setup-grafana
    - setup-heisenbridge
    - setup-hookshot
    - setup-int-scheduler
    - setup-jitsi
    - setup-kuma
    - setup-languagetool
    - setup-ma1sd
    - setup-mailer
    - setup-matrix-registration
    - setup-mautrix-discord
    - setup-mautrix-facebook
    - setup-mautrix-googlechat
    - setup-mautrix-hangouts
    - setup-mautrix-instagram
    - setup-mautrix-signal
    - setup-mautrix-telegram
    - setup-mautrix-twitter
    - setup-mautrix-whatsapp
    - setup-miniflux
    - setup-mx-puppet-discord
    - setup-mx-puppet-groupme
    - setup-mx-puppet-instagram
    - setup-mx-puppet-slack
    - setup-mx-puppet-steam
    - setup-mx-puppet-twitter
    - setup-nginx-proxy
    - setup-ntfy
    - setup-postgres
    - setup-postgres-backup
    - setup-prometheus
    - setup-prometheus-blackbox-exporter
    - setup-prometheus-node-exporter
    - setup-prometheus-postgres-exporter
    - setup-radicale
    - setup-redis
    - setup-sms-bridge
    - setup-softserve
    - setup-ssl
    - setup-sygnal
    - setup-synapse
    - setup-synapse-admin

- name: Ensure Synapse restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-synapse
  when: matrix_synapse_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-synapse

- name: Ensure Dendrite restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-dendrite
  when: matrix_dendrite_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-dendrite

- name: Ensure Ntfy restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ntfy
  when: matrix_ntfy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ntfy

- name: Ensure Database (postgres) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-postgres
  when: matrix_postgres_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-postgres

- name: Ensure Database Backup (postgres-backup) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-postgres-backup
  when: matrix_postgres_backup_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-postgres-backup

- name: Ensure Discord bridge (appservice) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-discord
  when: matrix_appservice_discord_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-discord

- name: Ensure IRC bridge (appservice) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-irc
  when: matrix_appservice_irc_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-irc

- name: Ensure Kakaotalk bridge restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-kakaotalk
  when: matrix_appservice_kakaotalk_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-kakaotalk

- name: Ensure Kakaotalk node restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-kakaotalk-node
  when: matrix_appservice_kakaotalk_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-kakaotalk

- name: Ensure Slack bridge (appservice) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-slack
  when: matrix_appservice_slack_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-slack

- name: Ensure Webhooks bridge (appservice) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-appservice-webhooks
  when: matrix_appservice_webhooks_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-appservice-webhooks

- name: Ensure borg backup timer restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-backup-borg.timer
  when: matrix_backup_borg_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-backup-borg

- name: Ensure linkedin bridge (beeper) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-beeper-linkedin
  when: matrix_beeper_linkedin_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-beeper-linkedin

- name: Ensure Buscarron restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-buscarron
  when: matrix_bot_buscarron_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-buscarron

- name: Ensure go-neb bot restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-go-neb
  when: matrix_bot_go_neb_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-go-neb

- name: Ensure Honoroit restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-honoroit
  when: matrix_bot_honoroit_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-honoroit

- name: Ensure reminder bot restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-matrix-reminder-bot
  when: matrix_bot_matrix_reminder_bot_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-matrix-reminder-bot

- name: Ensure maubot restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-maubot
  when: matrix_bot_maubot_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-maubot

- name: Ensure mjolnir bot restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-mjolnir
  when: matrix_bot_mjolnir_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-mjolnir

- name: Ensure Postmoogle bot restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-bot-postmoogle
  when: matrix_bot_postmoogle_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-bot-postmoogle

- name: Ensure Cactus Comments restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-cactus-comments.service
  when: matrix_cactus_comments_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-cactus-comments

- name: Ensure Cinny restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-client-cinny
  when: matrix_client_cinny_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-client-cinny

- name: Ensure Element restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-client-element
  when: matrix_client_element_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-client-element

- name: Ensure Hydrogen restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-client-hydrogen
  when: matrix_client_hydrogen_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-client-hydrogen

- name: Ensure Conduit restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-conduit
  when: matrix_conduit_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-conduit

- name: Ensure Corporal restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-corporal
  when: matrix_corporal_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-corporal

- name: Ensure Coturn (reload timer) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-coturn-reload.timer
  when: matrix_coturn_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-coturn

- name: Ensure Coturn restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-coturn
  when: matrix_coturn_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-coturn

- name: Ensure Dimension restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-dimension
  when: matrix_dimension_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-dimension

- name: Ensure dnsmasq restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-dnsmasq
  when: custom_dnsmasq_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-dnsmasq

- name: Ensure Dynamic DNS restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-dynamic-dns
  when: matrix_dynamic_dns_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-dynamic-dns

- name: Ensure Email2Matrix restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-email2matrix
  when: matrix_email2matrix_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-email2matrix

- name: Ensure Etherpad restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-etherpad
  when: matrix_etherpad_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-etherpad

- name: Ensure Skype bridge (go) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-go-skype-bridge
  when: matrix_go_skype_bridge_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-go-skype-bridge

- name: Ensure Grafana restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-grafana
  when: matrix_grafana_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-grafana

- name: Ensure IRC bridge (heisenbridge) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-heisenbridge
  when: matrix_heisenbridge_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-heisenbridge

- name: Ensure Hookshot bridge restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-hookshot
  when: matrix_hookshot_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-hookshot

- name: Ensure Jitsi Conference Focus restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-jitsi-jicofo
  when: matrix_jitsi_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-jitsi

- name: Ensure Jitsi Video Bridge restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-jitsi-jvb
  when: matrix_jitsi_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-jitsi

- name: Ensure Jitsi Prosody restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-jitsi-prosody
  when: matrix_jitsi_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-jitsi

- name: Ensure Jitsi Web restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-jitsi-web
  when: matrix_jitsi_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-jitsi

- name: Ensure Uptime Kuma restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-kuma
  when: custom_kuma_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-kuma

- name: Ensure LanguageTool restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-languagetool
  when: custom_languagetool_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-languagetool

- name: Ensure Identity Server (ma1sd) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ma1sd
  when: matrix_ma1sd_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ma1sd

- name: Ensure Mailer (exim) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mailer
  when: matrix_mailer_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mailer

- name: Ensure matrix-registration restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-registration
  when: matrix_registration_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-matrix-registration

- name: Ensure SMS bridge restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-sms-bridge
  when: matrix_sms_bridge_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-sms-bridge

- name: Ensure Soft-Serve restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-softserve
  when: custom_softserve_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-softserve

- name: Ensure Discord bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-discord
  when: matrix_mautrix_discord_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-discord

- name: Ensure Facebook bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-facebook
  when: matrix_mautrix_facebook_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-facebook

- name: Ensure Google Chat bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-googlechat
  when: matrix_mautrix_googlechat_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-googlechat

- name: Ensure Hangouts bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-hangouts
  when: matrix_mautrix_hangouts_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-hangouts

- name: Ensure Instagram bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-instagram
  when: matrix_mautrix_instagram_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-instagram

- name: Ensure Signal bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-signal
  when: matrix_mautrix_signal_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-signal

- name: Ensure Signal bridge's daemon (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-signal-daemon
  when: matrix_mautrix_signal_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-signal

- name: Ensure Telegram bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-telegram
  when: matrix_mautrix_telegram_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-telegram

- name: Ensure Twitter bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-twitter
  when: matrix_mautrix_twitter_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-twitter

- name: Ensure WhatsApp bridge (mautrix) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mautrix-whatsapp
  when: matrix_mautrix_whatsapp_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mautrix-whatsapp

- name: Ensure Miniflux restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-miniflux
  when: custom_miniflux_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-miniflux

- name: Ensure Discord bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-discord
  when: matrix_mx_puppet_discord_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-discord

- name: Ensure GroupMe bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-groupme
  when: matrix_mx_puppet_groupme_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-groupme

- name: Ensure Instagram bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-instagram
  when: matrix_mx_puppet_instagram_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-instagram

- name: Ensure Slack bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-slack
  when: matrix_mx_puppet_slack_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-slack

- name: Ensure Steam bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-steam
  when: matrix_mx_puppet_steam_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-steam

- name: Ensure Twitter bridge (mx-puppet) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-mx-puppet-twitter
  when: matrix_mx_puppet_twitter_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-mx-puppet-twitter

- name: Ensure ssl renewal service restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ssl-lets-encrypt-certificates-renew.service
  when: matrix_nginx_proxy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ssl
    - setup-nginx-proxy

- name: Ensure ssl renewal timer restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ssl-lets-encrypt-certificates-renew.timer
  when: matrix_nginx_proxy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ssl
    - setup-nginx-proxy

- name: Ensure nginx-proxy reload service restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ssl-nginx-proxy-reload.timer
  when: matrix_nginx_proxy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ssl
    - setup-nginx-proxy

- name: Ensure nginx-proxy reload timer restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-ssl-nginx-proxy-reload.timer
  when: matrix_nginx_proxy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ssl
    - setup-nginx-proxy

- name: Ensure Proxy (nginx) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-nginx-proxy
  when: matrix_nginx_proxy_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-ssl
    - setup-nginx-proxy

- name: Ensure Prometheus restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-prometheus
  when: matrix_prometheus_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-prometheus

- name: Ensure Prometheus Blackbox Exporter restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: int-prometheus-blackbox-exporter
  when: int_prometheus_blackbox_exporter_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-prometheus
    - setup-prometheus-blackbox-exporter

- name: Ensure Prometheus Node Exporter restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-prometheus-node-exporter
  when: matrix_prometheus_node_exporter_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-prometheus
    - setup-prometheus-node-exporter

- name: Ensure Prometheus Postgres Exporter restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-prometheus-postgres-exporter
  when: matrix_prometheus_postgres_exporter_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-prometheus
    - setup-prometheus-postgres-exporter

- name: Ensure Radicale restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: custom-radicale
  when: custom_radicale_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-radicale

- name: Ensure Redis restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-redis
  when: matrix_redis_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-redis

- name: Ensure Sygnal restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-sygnal
  when: matrix_sygnal_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-sygnal

- name: Ensure Synapse Admin restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: matrix-synapse-admin
  when: matrix_synapse_admin_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-synapse-admin

- name: Ensure internal scheduler (inventory updater) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: int-scheduler-update
  when: int_scheduler_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-int-scheduler

- name: Ensure internal scheduler (inventory updater timer) restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: int-scheduler-update.timer
  when: int_scheduler_enabled|bool
  ignore_errors: true
  tags:
    - setup-all
    - restart-all
    - setup-int-scheduler

- name: Ensure internal scheduler restarted
  ansible.builtin.service:
    enabled: true
    state: restarted
    name: int-scheduler
  when: int_scheduler_enabled|bool
  ignore_errors: true
  tags:
    - setup-int-scheduler
